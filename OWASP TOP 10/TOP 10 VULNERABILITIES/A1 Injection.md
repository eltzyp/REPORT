ОПИСАНИЕ:

Это опаснейшая уязвимость, позволяющая злоумышленнику получить доступ к базе данных и возможность читать/изменять/удалять информацию, которая для него не предназначена.  
  
Эта уязвимость является следствием недостаточной проверки данных, поступающих от пользователя. Это позволяет злоумышленнику подставить, например, в веб-формы, специально подготовленные запросы, которые «обманут» приложение и позволят прочитать или записать нелегитимные данные.  
  
Сообществом OWASP [были описаны](https://www.owasp.org/index.php/Top_10_2013-A1-Injection) пять основных методов (техник) атак при SQL-инъекциях.  
  
- **Оператор** **Union**: подход может быть использован при наличии уязвимости в запросе SELECT, позволяющей объединить два запроса в один результат или набор результатов.  
  
- **Логический метод**: предполагает использование логического условия, либо условий, позволяющих достоверно определить истинность или ложность некоего предположения.  
  
- **На основании ошибок**: этот метод предполагает намеренную передачу различных некорректных запросов, с целью вынудить web-приложение выдать информацию об ошибке, на основании которой, злоумышленник может составить и передать корректный инжектированный запрос.  
  
- **Метод с альтернативным каналом передачи данных**: метод предполагает использование альтернативного канала передачи извлеченных данных (например через исходящее HTTP соединение с web-сервером)  
  
- **Time delay**: метод использует команды базы данных, например sleep для того чтобы определить задержу по условным запросам. Метод эффективен, когда нет возможности получить ответ от web-приложения (результат, ошибка)  
  
Кроме того, может использоваться комбинированный подход, включающий в себя сочетание двух или более перечисленных техник.  
  
По способу извлечения данных выделяют три типа атак:  
  
- **Связанный:** данные в результате инжектированного SQL запроса извлекаются тем же путем, которым был передан сам инжектированный запрос. Это самый прямолинейный вид атаки, в результате которого, запрошенные модифицированным запросом данные, отображаются непосредственно на странице web-приложения.  
  
- **Не связанный**: данные в результате инжектированного SQL запроса извлекаются путем, отличным от способа передачи модифицированного запроса. (например данные передаются злоумышленнику в сообщении на электронную почту)  
  
- **Дедуктивный или слепой**: В результате SQL инъекции фактического извлечения данных не происходит, но злоумышленник может получить информацию, наблюдая за поведением web-сервера, в результате отправки серии специфических инжектированных SQL запросов.

РИСК:

Все данные, как правило, хранятся в специальных базах, обращения к которым строятся в виде запросов, чаще всего написанных на специальном языке запросов SQL.  
  
Приложения используют SQL-запросы для того, чтобы получать, добавлять, изменять или удалять данные, например при редактировании пользователем своих личных данных или заполнении анкеты на сайте. При недостаточной проверке данных от пользователя, злоумышленник может внедрить в форму Web-интерфейса приложения специальный код, содержащий кусок SQL-запроса.

ССЫЛКИ:

https://habr.com/ru/company/simplepay/blog/258499/  
https://proglib.io/p/chto-takoe-top-10-owasp-i-kakie-uyazvimosti-veb-prilozheniy-naibolee-opasny-2021-09-09  
[https://habr.com/ru/post/130826/](https://habr.com/ru/post/130826/)

РЕКОМЕНДАЦИИ ПО УСТРАНЕНИЮ:

Инъекционные атаки можно предотвратить путем проверки и/или очистки отправленных пользователем данных. В первом случае подозрительные данные отклоняются полностью, а во втором производится очистка только их подозрительной части. Кроме того, администратор базы данных может установить специальные элементы управления, чтобы минимизировать объем информации, которую может раскрыть атака с использованием SQL-инъекций.  
  
Большинство взломов через SQL происходят по причине нахождения в строках «необезвреженных» кавычек, апострофов и других специальных символов. Для такого обезвреживания нужно использовать функцию addslashes($str);, которая возвращает строку $str с добавленным обратным слешем (\) перед каждым специальным символом. Данный процесс называется экранизацией.  
  
`$a="пример текста с апострофом ' "; echo addslashes($a); //будет выведено: пример текста с апострофом \'`  
  
Кроме этого существуют две функции, созданные именно для экранизации строк, используемых в SQL выражениях.  
Это mysql_escape_string($str); и mysql_real_escape_string($str);.  
  
Первая не учитывает кодировку соединения с БД и может быть обойдена, а вот вторая её учитывает и абсолютно безопасна. mysql_real_escape_string($str); возвращает строку $str с добавленным обратным слешем к следующим символам: `\x00, \n, \r, \, ', " и \x1a`.  
  
Магические кавычки – эффект автоматической замены кавычки на обратный слэш (\) и кавычку при операциях ввода/вывода. В некоторых конфигурациях PHP этот параметр включён, а в некоторых нет. Для того, что бы избежать двойного экранизирования символов и заэкранизировать данные по-нормальному через mysql_real_escape_string($str);, необходимо убрать автоматические проставленные обратные слеши (если магические кавычки включены).  
  
Проверка включённости магических кавычек для данных получаемых из GET, POST или Куков организуется через функцию `get_magic_quotes_gpc();` (возвращает 1 – если магические кавычки включены, 0 – если отключены).  
  
Если магические кавычки включены (т.е обратные слеши добавляются) и такое встречается чаще, то их нужно убрать. Это делается через функцию stripslashes($str); (возвращает строку $str без обратных слешей у кавычек и прямых апострофов).  
  
Общие рекомендации:  
  
– Изолировать данные от команд и запросов;  
– Безопасный API или ORM;  
– Белые списки для проверки входных данных;  
– Экранирование спецсимволов;  
– LIMIT и т.п.




